# table 4, different organs
#################
tissues = names(table(expr_meta$tissue))
tissues = tissues[!tissues %in% c('breast', "prostate", "testis")]
results = NULL
for (hormone in c("ESR1_bin", "ESR2_bin", "PGR_bin", "AR_bin")){
for (virus_gene in c("ACE2_bin", "TMPRSS2_bin", "ACE2_TMPRSS2")){
for (t in tissues){
expr_meta$hormone = expr_meta[, hormone]
expr_meta$virus = expr_meta[, virus_gene]
#all age
expr_meta_subset = expr_meta[expr_meta$tissue %in% t,]
mylogit = (glm(virus ~ hormone +  gender + source + age , expr_meta_subset, family = binomial()))
odds = exp(cbind(OR = coef(mylogit), confint(mylogit)))
results = rbind(results, data.frame(age_group = "all", hormone, virus_gene, gender = "all", t, OR = round(odds["hormone", 1], 2), CI_25 =  round(odds["hormone", 2], 2) ,
CI_75 =  round(odds["hormone", 3],2) , p =  summary(mylogit)$coefficients["hormone", 4]))
expr_meta_subset =  expr_meta[expr_meta$gender %in% c("male") & expr_meta$tissue %in% t,]
mylogit = (glm(virus ~ hormone + source + age ,expr_meta_subset, family = binomial()))
odds = exp(cbind(OR = coef(mylogit), confint(mylogit)))
results = rbind(results, data.frame(age_group = "all", hormone, virus_gene,gender = "male",  t, OR = round(odds["hormone", 1], 2), CI_25 =  round(odds["hormone", 2], 2) ,
CI_75 =  round(odds["hormone", 3],2) , p =  summary(mylogit)$coefficients["hormone", 4]))
expr_meta_subset =  expr_meta[expr_meta$gender %in% c("female") & expr_meta$tissue %in% t,]
mylogit = (glm(virus ~ hormone +   source + age , expr_meta_subset, family = binomial()))
odds = exp(cbind(OR = coef(mylogit), confint(mylogit)))
results = rbind(results, data.frame(age_group = "all", hormone, virus_gene,gender = "female", t, OR = round(odds["hormone", 1], 2), CI_25 =  round(odds["hormone", 2], 2) ,
CI_75 =  round(odds["hormone", 3],2) , p =  summary(mylogit)$coefficients["hormone", 4]))
#old
expr_meta_subset =   expr_meta[expr_meta$age %in% c("60-100") & expr_meta$tissue %in% t ,]
if (nrow(expr_meta_subset) > 30 & !t %in% c( "prostate", "testis", "small intestine", "heart")){
mylogit = (glm(virus ~ hormone +  gender + source , expr_meta_subset, family = binomial()))
odds = exp(cbind(OR = coef(mylogit), confint(mylogit)))
results = rbind(results, data.frame(age_group = "old", hormone, virus_gene,gender = "all",  t, OR = round(odds["hormone", 1], 2), CI_25 =  round(odds["hormone", 2], 2) ,
CI_75 =  round(odds["hormone", 3],2) , p =  summary(mylogit)$coefficients["hormone", 4]))
}
expr_meta_subset =   expr_meta[expr_meta$age %in% c("60-100") & expr_meta$gender %in% c("male")  & expr_meta$tissue %in% t,]
if (nrow(expr_meta_subset) > 30 & !t %in% c("bone", "brain", "breast", "small intestine", "heart")){
mylogit = (glm(virus ~ hormone + source , expr_meta_subset, family = binomial()))
odds = exp(cbind(OR = coef(mylogit), confint(mylogit)))
results = rbind(results, data.frame(age_group = "old",hormone, virus_gene, gender = "male", t, OR = round(odds["hormone", 1], 2), CI_25 =  round(odds["hormone", 2], 2) ,
CI_75 =  round(odds["hormone", 3],2) , p =  summary(mylogit)$coefficients["hormone", 4]))
}
expr_meta_subset =   expr_meta[expr_meta$age %in% c("60-100") & expr_meta$gender %in% c("female")  & expr_meta$tissue %in% t,]
if (nrow(expr_meta_subset) > 30  & !t %in% c("bone", "brain", "heart", "prostate", "testis", "small intestine", "skin")){
mylogit = (glm(virus ~ hormone +   source  ,expr_meta_subset, family = binomial()))
odds = exp(cbind(OR = coef(mylogit), confint(mylogit)))
results = rbind(results, data.frame(age_group = "old", hormone, virus_gene,gender = "female", t, OR = round(odds["hormone", 1], 2), CI_25 =  round(odds["hormone", 2], 2) ,
CI_75 =  round(odds["hormone", 3],2) , p =  summary(mylogit)$coefficients["hormone", 4]))
}
}
}
}
results = NULL
for (hormone in c("ESR1_bin", "ESR2_bin", "PGR_bin", "AR_bin")){
for (virus_gene in c("ACE2_bin", "TMPRSS2_bin", "ACE2_TMPRSS2")){
for (t in tissues){
expr_meta$hormone = expr_meta[, hormone]
expr_meta$virus = expr_meta[, virus_gene]
#all age
expr_meta_subset = expr_meta[expr_meta$tissue %in% t,]
mylogit = (glm(virus ~ hormone +  gender + source + age , expr_meta_subset, family = binomial()))
odds = exp(cbind(OR = coef(mylogit), confint(mylogit)))
results = rbind(results, data.frame(age_group = "all", hormone, virus_gene, gender = "all", t, OR = round(odds["hormone", 1], 2), CI_25 =  round(odds["hormone", 2], 2) ,
CI_75 =  round(odds["hormone", 3],2) , p =  summary(mylogit)$coefficients["hormone", 4]))
expr_meta_subset =  expr_meta[expr_meta$gender %in% c("male") & expr_meta$tissue %in% t,]
mylogit = (glm(virus ~ hormone + source + age ,expr_meta_subset, family = binomial()))
odds = exp(cbind(OR = coef(mylogit), confint(mylogit)))
results = rbind(results, data.frame(age_group = "all", hormone, virus_gene,gender = "male",  t, OR = round(odds["hormone", 1], 2), CI_25 =  round(odds["hormone", 2], 2) ,
CI_75 =  round(odds["hormone", 3],2) , p =  summary(mylogit)$coefficients["hormone", 4]))
expr_meta_subset =  expr_meta[expr_meta$gender %in% c("female") & expr_meta$tissue %in% t,]
mylogit = (glm(virus ~ hormone +   source + age , expr_meta_subset, family = binomial()))
odds = exp(cbind(OR = coef(mylogit), confint(mylogit)))
results = rbind(results, data.frame(age_group = "all", hormone, virus_gene,gender = "female", t, OR = round(odds["hormone", 1], 2), CI_25 =  round(odds["hormone", 2], 2) ,
CI_75 =  round(odds["hormone", 3],2) , p =  summary(mylogit)$coefficients["hormone", 4]))
#old
expr_meta_subset =   expr_meta[expr_meta$age %in% c("60-100") & expr_meta$tissue %in% t ,]
if (nrow(expr_meta_subset) > 30 & !t %in% c( "prostate", "testis", "small intestine", "heart")){
mylogit = (glm(virus ~ hormone +  gender + source , expr_meta_subset, family = binomial()))
odds = exp(cbind(OR = coef(mylogit), confint(mylogit)))
results = rbind(results, data.frame(age_group = "old", hormone, virus_gene,gender = "all",  t, OR = round(odds["hormone", 1], 2), CI_25 =  round(odds["hormone", 2], 2) ,
CI_75 =  round(odds["hormone", 3],2) , p =  summary(mylogit)$coefficients["hormone", 4]))
}
expr_meta_subset =   expr_meta[expr_meta$age %in% c("60-100") & expr_meta$gender %in% c("male")  & expr_meta$tissue %in% t,]
if (nrow(expr_meta_subset) > 30 & !t %in% c("bone", "brain", "breast", "small intestine", "heart")){
mylogit = (glm(virus ~ hormone + source , expr_meta_subset, family = binomial()))
odds = exp(cbind(OR = coef(mylogit), confint(mylogit)))
results = rbind(results, data.frame(age_group = "old",hormone, virus_gene, gender = "male", t, OR = round(odds["hormone", 1], 2), CI_25 =  round(odds["hormone", 2], 2) ,
CI_75 =  round(odds["hormone", 3],2) , p =  summary(mylogit)$coefficients["hormone", 4]))
}
expr_meta_subset =   expr_meta[expr_meta$age %in% c("60-100") & expr_meta$gender %in% c("female")  & expr_meta$tissue %in% t,]
if (nrow(expr_meta_subset) > 30  & !t %in% c("bone", "brain", "heart", "prostate", "testis", "small intestine", "skin")){
mylogit = (glm(virus ~ hormone +   source  ,expr_meta_subset, family = binomial()))
odds = exp(cbind(OR = coef(mylogit), confint(mylogit)))
results = rbind(results, data.frame(age_group = "old", hormone, virus_gene,gender = "female", t, OR = round(odds["hormone", 1], 2), CI_25 =  round(odds["hormone", 2], 2) ,
CI_75 =  round(odds["hormone", 3],2) , p =  summary(mylogit)$coefficients["hormone", 4]))
}
}
}
}
##################
# table 4, different organs
#################
tissues = names(table(expr_meta$tissue))
tissues = tissues[!tissues %in% c('breast', "prostate", "testis")]
results = NULL
for (hormone in c("ESR1_bin", "ESR2_bin", "PGR_bin", "AR_bin")){
for (virus_gene in c("ACE2_bin", "TMPRSS2_bin", "ACE2_TMPRSS2")){
for (t in tissues){
expr_meta$hormone = expr_meta[, hormone]
expr_meta$virus = expr_meta[, virus_gene]
#all age
expr_meta_subset = expr_meta[expr_meta$tissue %in% t,]
mylogit = (glm(virus ~ hormone +  gender + source + age , expr_meta_subset, family = binomial()))
odds = exp(cbind(OR = coef(mylogit), confint(mylogit)))
results = rbind(results, data.frame(age_group = "all", hormone, virus_gene, gender = "all", tissue=t, OR = round(odds["hormone", 1], 2), CI_25 =  round(odds["hormone", 2], 2) ,
CI_75 =  round(odds["hormone", 3],2) , p =  summary(mylogit)$coefficients["hormone", 4]))
expr_meta_subset =  expr_meta[expr_meta$gender %in% c("male") & expr_meta$tissue %in% t,]
mylogit = (glm(virus ~ hormone + source + age ,expr_meta_subset, family = binomial()))
odds = exp(cbind(OR = coef(mylogit), confint(mylogit)))
results = rbind(results, data.frame(age_group = "all", hormone, virus_gene,gender = "male",  tissue=t, OR = round(odds["hormone", 1], 2), CI_25 =  round(odds["hormone", 2], 2) ,
CI_75 =  round(odds["hormone", 3],2) , p =  summary(mylogit)$coefficients["hormone", 4]))
expr_meta_subset =  expr_meta[expr_meta$gender %in% c("female") & expr_meta$tissue %in% t,]
mylogit = (glm(virus ~ hormone +   source + age , expr_meta_subset, family = binomial()))
odds = exp(cbind(OR = coef(mylogit), confint(mylogit)))
results = rbind(results, data.frame(age_group = "all", hormone, virus_gene,gender = "female", tissue=t, OR = round(odds["hormone", 1], 2), CI_25 =  round(odds["hormone", 2], 2) ,
CI_75 =  round(odds["hormone", 3],2) , p =  summary(mylogit)$coefficients["hormone", 4]))
#old
expr_meta_subset =   expr_meta[expr_meta$age %in% c("60-100") & expr_meta$tissue %in% t ,]
if (nrow(expr_meta_subset) > 30 & !t %in% c( "prostate", "testis", "small intestine", "heart")){
mylogit = (glm(virus ~ hormone +  gender + source , expr_meta_subset, family = binomial()))
odds = exp(cbind(OR = coef(mylogit), confint(mylogit)))
results = rbind(results, data.frame(age_group = "old", hormone, virus_gene,gender = "all",  tissue=t, OR = round(odds["hormone", 1], 2), CI_25 =  round(odds["hormone", 2], 2) ,
CI_75 =  round(odds["hormone", 3],2) , p =  summary(mylogit)$coefficients["hormone", 4]))
}
expr_meta_subset =   expr_meta[expr_meta$age %in% c("60-100") & expr_meta$gender %in% c("male")  & expr_meta$tissue %in% t,]
if (nrow(expr_meta_subset) > 30 & !t %in% c("bone", "brain", "breast", "small intestine", "heart")){
mylogit = (glm(virus ~ hormone + source , expr_meta_subset, family = binomial()))
odds = exp(cbind(OR = coef(mylogit), confint(mylogit)))
results = rbind(results, data.frame(age_group = "old",hormone, virus_gene, gender = "male", tissue=t, OR = round(odds["hormone", 1], 2), CI_25 =  round(odds["hormone", 2], 2) ,
CI_75 =  round(odds["hormone", 3],2) , p =  summary(mylogit)$coefficients["hormone", 4]))
}
expr_meta_subset =   expr_meta[expr_meta$age %in% c("60-100") & expr_meta$gender %in% c("female")  & expr_meta$tissue %in% t,]
if (nrow(expr_meta_subset) > 30  & !t %in% c("bone", "brain", "heart", "prostate", "testis", "small intestine", "skin")){
mylogit = (glm(virus ~ hormone +   source  ,expr_meta_subset, family = binomial()))
odds = exp(cbind(OR = coef(mylogit), confint(mylogit)))
results = rbind(results, data.frame(age_group = "old", hormone, virus_gene,gender = "female", tissue=t, OR = round(odds["hormone", 1], 2), CI_25 =  round(odds["hormone", 2], 2) ,
CI_75 =  round(odds["hormone", 3],2) , p =  summary(mylogit)$coefficients["hormone", 4]))
}
}
}
}
##################
# table 4, different organs
#################
tissues = names(table(expr_meta$tissue))
tissues = tissues[!tissues %in% c('breast', "prostate", "testis")]
results = NULL
for (hormone in c("ESR1_bin", "ESR2_bin", "PGR_bin", "AR_bin")){
for (virus_gene in c("ACE2_bin", "TMPRSS2_bin", "ACE2_TMPRSS2")){
for (t in tissues){
print(hormone, virus_gene, t)
expr_meta$hormone = expr_meta[, hormone]
expr_meta$virus = expr_meta[, virus_gene]
#all age
expr_meta_subset = expr_meta[expr_meta$tissue %in% t,]
mylogit = (glm(virus ~ hormone +  gender + source + age , expr_meta_subset, family = binomial()))
odds = exp(cbind(OR = coef(mylogit), confint(mylogit)))
results = rbind(results, data.frame(age_group = "all", hormone, virus_gene, gender = "all", tissue=t, OR = round(odds["hormone", 1], 2), CI_25 =  round(odds["hormone", 2], 2) ,
CI_75 =  round(odds["hormone", 3],2) , p =  summary(mylogit)$coefficients["hormone", 4]))
expr_meta_subset =  expr_meta[expr_meta$gender %in% c("male") & expr_meta$tissue %in% t,]
mylogit = (glm(virus ~ hormone + source + age ,expr_meta_subset, family = binomial()))
odds = exp(cbind(OR = coef(mylogit), confint(mylogit)))
results = rbind(results, data.frame(age_group = "all", hormone, virus_gene,gender = "male",  tissue=t, OR = round(odds["hormone", 1], 2), CI_25 =  round(odds["hormone", 2], 2) ,
CI_75 =  round(odds["hormone", 3],2) , p =  summary(mylogit)$coefficients["hormone", 4]))
expr_meta_subset =  expr_meta[expr_meta$gender %in% c("female") & expr_meta$tissue %in% t,]
mylogit = (glm(virus ~ hormone +   source + age , expr_meta_subset, family = binomial()))
odds = exp(cbind(OR = coef(mylogit), confint(mylogit)))
results = rbind(results, data.frame(age_group = "all", hormone, virus_gene,gender = "female", tissue=t, OR = round(odds["hormone", 1], 2), CI_25 =  round(odds["hormone", 2], 2) ,
CI_75 =  round(odds["hormone", 3],2) , p =  summary(mylogit)$coefficients["hormone", 4]))
#old
expr_meta_subset =   expr_meta[expr_meta$age %in% c("60-100") & expr_meta$tissue %in% t ,]
if (nrow(expr_meta_subset) > 30 & !t %in% c( "prostate", "testis", "small intestine", "heart")){
mylogit = (glm(virus ~ hormone +  gender + source , expr_meta_subset, family = binomial()))
odds = exp(cbind(OR = coef(mylogit), confint(mylogit)))
results = rbind(results, data.frame(age_group = "old", hormone, virus_gene,gender = "all",  tissue=t, OR = round(odds["hormone", 1], 2), CI_25 =  round(odds["hormone", 2], 2) ,
CI_75 =  round(odds["hormone", 3],2) , p =  summary(mylogit)$coefficients["hormone", 4]))
}
expr_meta_subset =   expr_meta[expr_meta$age %in% c("60-100") & expr_meta$gender %in% c("male")  & expr_meta$tissue %in% t,]
if (nrow(expr_meta_subset) > 30 & !t %in% c("bone", "brain", "breast", "small intestine", "heart")){
mylogit = (glm(virus ~ hormone + source , expr_meta_subset, family = binomial()))
odds = exp(cbind(OR = coef(mylogit), confint(mylogit)))
results = rbind(results, data.frame(age_group = "old",hormone, virus_gene, gender = "male", tissue=t, OR = round(odds["hormone", 1], 2), CI_25 =  round(odds["hormone", 2], 2) ,
CI_75 =  round(odds["hormone", 3],2) , p =  summary(mylogit)$coefficients["hormone", 4]))
}
expr_meta_subset =   expr_meta[expr_meta$age %in% c("60-100") & expr_meta$gender %in% c("female")  & expr_meta$tissue %in% t,]
if (nrow(expr_meta_subset) > 30  & !t %in% c("bone", "brain", "heart", "prostate", "testis", "small intestine", "skin")){
mylogit = (glm(virus ~ hormone +   source  ,expr_meta_subset, family = binomial()))
odds = exp(cbind(OR = coef(mylogit), confint(mylogit)))
results = rbind(results, data.frame(age_group = "old", hormone, virus_gene,gender = "female", tissue=t, OR = round(odds["hormone", 1], 2), CI_25 =  round(odds["hormone", 2], 2) ,
CI_75 =  round(odds["hormone", 3],2) , p =  summary(mylogit)$coefficients["hormone", 4]))
}
}
}
}
results = NULL
for (hormone in c("ESR1_bin", "ESR2_bin", "PGR_bin", "AR_bin")){
for (virus_gene in c("ACE2_bin", "TMPRSS2_bin", "ACE2_TMPRSS2")){
for (t in tissues){
print(c(hormone, virus_gene, t))
expr_meta$hormone = expr_meta[, hormone]
expr_meta$virus = expr_meta[, virus_gene]
#all age
expr_meta_subset = expr_meta[expr_meta$tissue %in% t,]
mylogit = (glm(virus ~ hormone +  gender + source + age , expr_meta_subset, family = binomial()))
odds = exp(cbind(OR = coef(mylogit), confint(mylogit)))
results = rbind(results, data.frame(age_group = "all", hormone, virus_gene, gender = "all", tissue=t, OR = round(odds["hormone", 1], 2), CI_25 =  round(odds["hormone", 2], 2) ,
CI_75 =  round(odds["hormone", 3],2) , p =  summary(mylogit)$coefficients["hormone", 4]))
expr_meta_subset =  expr_meta[expr_meta$gender %in% c("male") & expr_meta$tissue %in% t,]
mylogit = (glm(virus ~ hormone + source + age ,expr_meta_subset, family = binomial()))
odds = exp(cbind(OR = coef(mylogit), confint(mylogit)))
results = rbind(results, data.frame(age_group = "all", hormone, virus_gene,gender = "male",  tissue=t, OR = round(odds["hormone", 1], 2), CI_25 =  round(odds["hormone", 2], 2) ,
CI_75 =  round(odds["hormone", 3],2) , p =  summary(mylogit)$coefficients["hormone", 4]))
expr_meta_subset =  expr_meta[expr_meta$gender %in% c("female") & expr_meta$tissue %in% t,]
mylogit = (glm(virus ~ hormone +   source + age , expr_meta_subset, family = binomial()))
odds = exp(cbind(OR = coef(mylogit), confint(mylogit)))
results = rbind(results, data.frame(age_group = "all", hormone, virus_gene,gender = "female", tissue=t, OR = round(odds["hormone", 1], 2), CI_25 =  round(odds["hormone", 2], 2) ,
CI_75 =  round(odds["hormone", 3],2) , p =  summary(mylogit)$coefficients["hormone", 4]))
#old
expr_meta_subset =   expr_meta[expr_meta$age %in% c("60-100") & expr_meta$tissue %in% t ,]
if (nrow(expr_meta_subset) > 30 & !t %in% c( "prostate", "testis", "small intestine", "heart")){
mylogit = (glm(virus ~ hormone +  gender + source , expr_meta_subset, family = binomial()))
odds = exp(cbind(OR = coef(mylogit), confint(mylogit)))
results = rbind(results, data.frame(age_group = "old", hormone, virus_gene,gender = "all",  tissue=t, OR = round(odds["hormone", 1], 2), CI_25 =  round(odds["hormone", 2], 2) ,
CI_75 =  round(odds["hormone", 3],2) , p =  summary(mylogit)$coefficients["hormone", 4]))
}
expr_meta_subset =   expr_meta[expr_meta$age %in% c("60-100") & expr_meta$gender %in% c("male")  & expr_meta$tissue %in% t,]
if (nrow(expr_meta_subset) > 30 & !t %in% c("bone", "brain", "breast", "small intestine", "heart")){
mylogit = (glm(virus ~ hormone + source , expr_meta_subset, family = binomial()))
odds = exp(cbind(OR = coef(mylogit), confint(mylogit)))
results = rbind(results, data.frame(age_group = "old",hormone, virus_gene, gender = "male", tissue=t, OR = round(odds["hormone", 1], 2), CI_25 =  round(odds["hormone", 2], 2) ,
CI_75 =  round(odds["hormone", 3],2) , p =  summary(mylogit)$coefficients["hormone", 4]))
}
expr_meta_subset =   expr_meta[expr_meta$age %in% c("60-100") & expr_meta$gender %in% c("female")  & expr_meta$tissue %in% t,]
if (nrow(expr_meta_subset) > 30  & !t %in% c("bone", "brain", "heart", "prostate", "testis", "small intestine", "skin")){
mylogit = (glm(virus ~ hormone +   source  ,expr_meta_subset, family = binomial()))
odds = exp(cbind(OR = coef(mylogit), confint(mylogit)))
results = rbind(results, data.frame(age_group = "old", hormone, virus_gene,gender = "female", tissue=t, OR = round(odds["hormone", 1], 2), CI_25 =  round(odds["hormone", 2], 2) ,
CI_75 =  round(odds["hormone", 3],2) , p =  summary(mylogit)$coefficients["hormone", 4]))
}
}
}
}
View(expr_meta_subset)
mylogit = (glm(virus ~ hormone + source , expr_meta_subset, family = binomial()))
odds = exp(cbind(OR = coef(mylogit), confint(mylogit)))
summary(mylogit)
View(expr_meta_subset)
table(expr_meta_subset$virus)
unique(expr_meta_subset$virus)
if (nrow(expr_meta_subset) > 30 & !t %in% c("bone", "brain", "breast", "small intestine", "heart") & length(unique(expr_meta_subset$virus))!=1){
mylogit = (glm(virus ~ hormone + source , expr_meta_subset, family = binomial()))
odds = exp(cbind(OR = coef(mylogit), confint(mylogit)))
results = rbind(results, data.frame(age_group = "old",hormone, virus_gene, gender = "male", tissue=t, OR = round(odds["hormone", 1], 2), CI_25 =  round(odds["hormone", 2], 2) ,
CI_75 =  round(odds["hormone", 3],2) , p =  summary(mylogit)$coefficients["hormone", 4]))
}
expr_meta_subset =   expr_meta[expr_meta$age %in% c("60-100") & expr_meta$gender %in% c("female")  & expr_meta$tissue %in% t,]
if (nrow(expr_meta_subset) > 30  & !t %in% c("bone", "brain", "heart", "prostate", "testis", "small intestine", "skin") & length(unique(expr_meta_subset$virus))!=1){
mylogit = (glm(virus ~ hormone +  source  ,expr_meta_subset, family = binomial()))
odds = exp(cbind(OR = coef(mylogit), confint(mylogit)))
results = rbind(results, data.frame(age_group = "old", hormone, virus_gene,gender = "female", tissue=t, OR = round(odds["hormone", 1], 2), CI_25 =  round(odds["hormone", 2], 2) ,
CI_75 =  round(odds["hormone", 3],2) , p =  summary(mylogit)$coefficients["hormone", 4]))
}
View(results)
length(unique(expr_meta_subset))
length(unique(expr_meta_subset$virus))
unique(expr_meta_subset$virus)
##################
# table 4, different organs
#################
tissues = names(table(expr_meta$tissue))
tissues = tissues[!tissues %in% c('breast', "prostate", "testis")]
results = NULL
for (hormone in c("ESR1_bin", "ESR2_bin", "PGR_bin", "AR_bin")){
for (virus_gene in c("ACE2_bin", "TMPRSS2_bin", "ACE2_TMPRSS2")){
for (t in tissues){
print(c(hormone, virus_gene, t))
expr_meta$hormone = expr_meta[, hormone]
expr_meta$virus = expr_meta[, virus_gene]
#all age
expr_meta_subset = expr_meta[expr_meta$tissue %in% t,]
mylogit = (glm(virus ~ hormone +  gender + source + age , expr_meta_subset, family = binomial()))
odds = exp(cbind(OR = coef(mylogit), confint(mylogit)))
results = rbind(results, data.frame(age_group = "all", hormone, virus_gene, gender = "all", tissue=t, OR = round(odds["hormone", 1], 2), CI_25 =  round(odds["hormone", 2], 2) ,
CI_75 =  round(odds["hormone", 3],2) , p =  summary(mylogit)$coefficients["hormone", 4]))
expr_meta_subset =  expr_meta[expr_meta$gender %in% c("male") & expr_meta$tissue %in% t,]
mylogit = (glm(virus ~ hormone + source + age ,expr_meta_subset, family = binomial()))
odds = exp(cbind(OR = coef(mylogit), confint(mylogit)))
results = rbind(results, data.frame(age_group = "all", hormone, virus_gene,gender = "male",  tissue=t, OR = round(odds["hormone", 1], 2), CI_25 =  round(odds["hormone", 2], 2) ,
CI_75 =  round(odds["hormone", 3],2) , p =  summary(mylogit)$coefficients["hormone", 4]))
expr_meta_subset =  expr_meta[expr_meta$gender %in% c("female") & expr_meta$tissue %in% t,]
mylogit = (glm(virus ~ hormone +  source + age , expr_meta_subset, family = binomial()))
odds = exp(cbind(OR = coef(mylogit), confint(mylogit)))
results = rbind(results, data.frame(age_group = "all", hormone, virus_gene,gender = "female", tissue=t, OR = round(odds["hormone", 1], 2), CI_25 =  round(odds["hormone", 2], 2) ,
CI_75 =  round(odds["hormone", 3],2) , p =  summary(mylogit)$coefficients["hormone", 4]))
#old
expr_meta_subset =   expr_meta[expr_meta$age %in% c("60-100") & expr_meta$tissue %in% t ,]
if (nrow(expr_meta_subset) > 30 & !t %in% c( "prostate", "testis", "small intestine", "heart")){
mylogit = (glm(virus ~ hormone +  gender + source , expr_meta_subset, family = binomial()))
odds = exp(cbind(OR = coef(mylogit), confint(mylogit)))
results = rbind(results, data.frame(age_group = "old", hormone, virus_gene,gender = "all",  tissue=t, OR = round(odds["hormone", 1], 2), CI_25 =  round(odds["hormone", 2], 2) ,
CI_75 =  round(odds["hormone", 3],2) , p =  summary(mylogit)$coefficients["hormone", 4]))
}
expr_meta_subset =   expr_meta[expr_meta$age %in% c("60-100") & expr_meta$gender %in% c("male")  & expr_meta$tissue %in% t,]
if (nrow(expr_meta_subset) > 30 & !t %in% c("bone", "brain", "breast", "small intestine", "heart") & length(unique(expr_meta_subset$virus))!=1){
mylogit = (glm(virus ~ hormone + source , expr_meta_subset, family = binomial()))
odds = exp(cbind(OR = coef(mylogit), confint(mylogit)))
results = rbind(results, data.frame(age_group = "old",hormone, virus_gene, gender = "male", tissue=t, OR = round(odds["hormone", 1], 2), CI_25 =  round(odds["hormone", 2], 2) ,
CI_75 =  round(odds["hormone", 3],2) , p =  summary(mylogit)$coefficients["hormone", 4]))
}
expr_meta_subset =   expr_meta[expr_meta$age %in% c("60-100") & expr_meta$gender %in% c("female")  & expr_meta$tissue %in% t,]
if (nrow(expr_meta_subset) > 30  & !t %in% c("bone", "brain", "heart", "prostate", "testis", "small intestine", "skin") & length(unique(expr_meta_subset$virus))!=1){
mylogit = (glm(virus ~ hormone +  source  ,expr_meta_subset, family = binomial()))
odds = exp(cbind(OR = coef(mylogit), confint(mylogit)))
results = rbind(results, data.frame(age_group = "old", hormone, virus_gene,gender = "female", tissue=t, OR = round(odds["hormone", 1], 2), CI_25 =  round(odds["hormone", 2], 2) ,
CI_75 =  round(odds["hormone", 3],2) , p =  summary(mylogit)$coefficients["hormone", 4]))
}
}
}
}
##################
# table 4, different organs
#################
tissues = names(table(expr_meta$tissue))
tissues = tissues[!tissues %in% c('breast', "prostate", "testis")]
results = NULL
for (hormone in c("ESR1_bin", "ESR2_bin", "PGR_bin", "AR_bin")){
for (virus_gene in c("ACE2_bin", "TMPRSS2_bin", "ACE2_TMPRSS2")){
for (t in tissues){
print(c(hormone, virus_gene, t))
expr_meta$hormone = expr_meta[, hormone]
expr_meta$virus = expr_meta[, virus_gene]
#all age
expr_meta_subset = expr_meta[expr_meta$tissue %in% t,]
mylogit = (glm(virus ~ hormone +  gender + source + age , expr_meta_subset, family = binomial()))
odds = exp(cbind(OR = coef(mylogit), confint(mylogit)))
results = rbind(results, data.frame(age_group = "all", hormone, virus_gene, gender = "all", tissue=t, OR = round(odds["hormone", 1], 2), CI_25 =  round(odds["hormone", 2], 2) ,
CI_75 =  round(odds["hormone", 3],2) , p =  summary(mylogit)$coefficients["hormone", 4]))
expr_meta_subset =  expr_meta[expr_meta$gender %in% c("male") & expr_meta$tissue %in% t,]
mylogit = (glm(virus ~ hormone + source + age ,expr_meta_subset, family = binomial()))
odds = exp(cbind(OR = coef(mylogit), confint(mylogit)))
results = rbind(results, data.frame(age_group = "all", hormone, virus_gene,gender = "male",  tissue=t, OR = round(odds["hormone", 1], 2), CI_25 =  round(odds["hormone", 2], 2) ,
CI_75 =  round(odds["hormone", 3],2) , p =  summary(mylogit)$coefficients["hormone", 4]))
expr_meta_subset =  expr_meta[expr_meta$gender %in% c("female") & expr_meta$tissue %in% t,]
mylogit = (glm(virus ~ hormone +  source + age , expr_meta_subset, family = binomial()))
odds = exp(cbind(OR = coef(mylogit), confint(mylogit)))
results = rbind(results, data.frame(age_group = "all", hormone, virus_gene,gender = "female", tissue=t, OR = round(odds["hormone", 1], 2), CI_25 =  round(odds["hormone", 2], 2) ,
CI_75 =  round(odds["hormone", 3],2) , p =  summary(mylogit)$coefficients["hormone", 4]))
#old
expr_meta_subset =   expr_meta[expr_meta$age %in% c("60-100") & expr_meta$tissue %in% t ,]
if (nrow(expr_meta_subset) > 30 & !t %in% c( "prostate", "testis", "small intestine", "heart") & length(unique(expr_meta_subset$virus))!=1){
mylogit = (glm(virus ~ hormone +  gender + source , expr_meta_subset, family = binomial()))
odds = exp(cbind(OR = coef(mylogit), confint(mylogit)))
results = rbind(results, data.frame(age_group = "old", hormone, virus_gene,gender = "all",  tissue=t, OR = round(odds["hormone", 1], 2), CI_25 =  round(odds["hormone", 2], 2) ,
CI_75 =  round(odds["hormone", 3],2) , p =  summary(mylogit)$coefficients["hormone", 4]))
}
expr_meta_subset =   expr_meta[expr_meta$age %in% c("60-100") & expr_meta$gender %in% c("male")  & expr_meta$tissue %in% t,]
if (nrow(expr_meta_subset) > 30 & !t %in% c("bone", "brain", "breast", "small intestine", "heart") & length(unique(expr_meta_subset$virus))!=1){
mylogit = (glm(virus ~ hormone + source , expr_meta_subset, family = binomial()))
odds = exp(cbind(OR = coef(mylogit), confint(mylogit)))
results = rbind(results, data.frame(age_group = "old",hormone, virus_gene, gender = "male", tissue=t, OR = round(odds["hormone", 1], 2), CI_25 =  round(odds["hormone", 2], 2) ,
CI_75 =  round(odds["hormone", 3],2) , p =  summary(mylogit)$coefficients["hormone", 4]))
}
expr_meta_subset =   expr_meta[expr_meta$age %in% c("60-100") & expr_meta$gender %in% c("female")  & expr_meta$tissue %in% t,]
if (nrow(expr_meta_subset) > 30  & !t %in% c("bone", "brain", "heart", "prostate", "testis", "small intestine", "skin") & length(unique(expr_meta_subset$virus))!=1){
mylogit = (glm(virus ~ hormone +  source  ,expr_meta_subset, family = binomial()))
odds = exp(cbind(OR = coef(mylogit), confint(mylogit)))
results = rbind(results, data.frame(age_group = "old", hormone, virus_gene,gender = "female", tissue=t, OR = round(odds["hormone", 1], 2), CI_25 =  round(odds["hormone", 2], 2) ,
CI_75 =  round(odds["hormone", 3],2) , p =  summary(mylogit)$coefficients["hormone", 4]))
}
}
}
}
View(mylogit)
summary(mylogit)
summary(mylogit)$coefficients["hormone", 4]
summary(mylogit)$coefficients
expr_meta_subset$hormone
##################
# table 4, different organs
#################
tissues = names(table(expr_meta$tissue))
tissues = tissues[!tissues %in% c('breast', "prostate", "testis")]
results = NULL
for (hormone in c("ESR1_bin", "ESR2_bin", "PGR_bin", "AR_bin")){
for (virus_gene in c("ACE2_bin", "TMPRSS2_bin", "ACE2_TMPRSS2")){
for (t in tissues){
print(c(hormone, virus_gene, t))
expr_meta$hormone = expr_meta[, hormone]
expr_meta$virus = expr_meta[, virus_gene]
#all age
expr_meta_subset = expr_meta[expr_meta$tissue %in% t,]
if (length(unique(expr_meta_subset$virus))!=1 & length(unique(expr_meta_subset$hormone))!=1){
mylogit = (glm(virus ~ hormone +  gender + source + age , expr_meta_subset, family = binomial()))
odds = exp(cbind(OR = coef(mylogit), confint(mylogit)))
results = rbind(results, data.frame(age_group = "all", hormone, virus_gene, gender = "all", tissue=t, OR = round(odds["hormone", 1], 2), CI_25 =  round(odds["hormone", 2], 2) ,
CI_75 =  round(odds["hormone", 3],2) , p =  summary(mylogit)$coefficients["hormone", 4]))
}
if (length(unique(expr_meta_subset$virus))!=1 & length(unique(expr_meta_subset$hormone))!=1){
expr_meta_subset =  expr_meta[expr_meta$gender %in% c("male") & expr_meta$tissue %in% t,]
mylogit = (glm(virus ~ hormone + source + age ,expr_meta_subset, family = binomial()))
odds = exp(cbind(OR = coef(mylogit), confint(mylogit)))
results = rbind(results, data.frame(age_group = "all", hormone, virus_gene,gender = "male",  tissue=t, OR = round(odds["hormone", 1], 2), CI_25 =  round(odds["hormone", 2], 2) ,
CI_75 =  round(odds["hormone", 3],2) , p =  summary(mylogit)$coefficients["hormone", 4]))
}
if (length(unique(expr_meta_subset$virus))!=1 & length(unique(expr_meta_subset$hormone))!=1){
expr_meta_subset =  expr_meta[expr_meta$gender %in% c("female") & expr_meta$tissue %in% t,]
mylogit = (glm(virus ~ hormone +  source + age , expr_meta_subset, family = binomial()))
odds = exp(cbind(OR = coef(mylogit), confint(mylogit)))
results = rbind(results, data.frame(age_group = "all", hormone, virus_gene,gender = "female", tissue=t, OR = round(odds["hormone", 1], 2), CI_25 =  round(odds["hormone", 2], 2) ,
CI_75 =  round(odds["hormone", 3],2) , p =  summary(mylogit)$coefficients["hormone", 4]))
}
#old
expr_meta_subset =   expr_meta[expr_meta$age %in% c("60-100") & expr_meta$tissue %in% t ,]
if (nrow(expr_meta_subset) > 30 & !t %in% c( "prostate", "testis", "small intestine", "heart") & length(unique(expr_meta_subset$virus))!=1 & length(unique(expr_meta_subset$hormone))!=1){
mylogit = (glm(virus ~ hormone +  gender + source , expr_meta_subset, family = binomial()))
odds = exp(cbind(OR = coef(mylogit), confint(mylogit)))
results = rbind(results, data.frame(age_group = "old", hormone, virus_gene,gender = "all",  tissue=t, OR = round(odds["hormone", 1], 2), CI_25 =  round(odds["hormone", 2], 2) ,
CI_75 =  round(odds["hormone", 3],2) , p =  summary(mylogit)$coefficients["hormone", 4]))
}
expr_meta_subset =   expr_meta[expr_meta$age %in% c("60-100") & expr_meta$gender %in% c("male")  & expr_meta$tissue %in% t,]
if (nrow(expr_meta_subset) > 30 & !t %in% c("bone", "brain", "breast", "small intestine", "heart") & length(unique(expr_meta_subset$virus))!=1 & length(unique(expr_meta_subset$hormone))!=1){
mylogit = (glm(virus ~ hormone + source , expr_meta_subset, family = binomial()))
odds = exp(cbind(OR = coef(mylogit), confint(mylogit)))
results = rbind(results, data.frame(age_group = "old",hormone, virus_gene, gender = "male", tissue=t, OR = round(odds["hormone", 1], 2), CI_25 =  round(odds["hormone", 2], 2) ,
CI_75 =  round(odds["hormone", 3],2) , p =  summary(mylogit)$coefficients["hormone", 4]))
}
expr_meta_subset =   expr_meta[expr_meta$age %in% c("60-100") & expr_meta$gender %in% c("female")  & expr_meta$tissue %in% t,]
if (nrow(expr_meta_subset) > 30  & !t %in% c("bone", "brain", "heart", "prostate", "testis", "small intestine", "skin") & length(unique(expr_meta_subset$virus))!=1 & length(unique(expr_meta_subset$hormone))!=1){
mylogit = (glm(virus ~ hormone +  source  ,expr_meta_subset, family = binomial()))
odds = exp(cbind(OR = coef(mylogit), confint(mylogit)))
results = rbind(results, data.frame(age_group = "old", hormone, virus_gene,gender = "female", tissue=t, OR = round(odds["hormone", 1], 2), CI_25 =  round(odds["hormone", 2], 2) ,
CI_75 =  round(odds["hormone", 3],2) , p =  summary(mylogit)$coefficients["hormone", 4]))
}
}
}
}
summary(mylogit)
summary(mylogit)$coefficients
View(expr_meta_subset)
table(expr_meta_subset$virus)
table(expr_meta_subset$hormone)
length(unique(expr_meta_subset$hormone))
##################
# table 4, different organs
#################
tissues = names(table(expr_meta$tissue))
tissues = tissues[!tissues %in% c('breast', "prostate", "testis")]
results = NULL
for (hormone in c("ESR1_bin", "ESR2_bin", "PGR_bin", "AR_bin")){
for (virus_gene in c("ACE2_bin", "TMPRSS2_bin", "ACE2_TMPRSS2")){
for (t in tissues){
print(c(hormone, virus_gene, t))
expr_meta$hormone = expr_meta[, hormone]
expr_meta$virus = expr_meta[, virus_gene]
#all age
expr_meta_subset = expr_meta[expr_meta$tissue %in% t,]
if (length(unique(expr_meta_subset$virus))!=1 & length(unique(expr_meta_subset$hormone))!=1){
mylogit = (glm(virus ~ hormone +  gender + source + age , expr_meta_subset, family = binomial()))
odds = exp(cbind(OR = coef(mylogit), confint(mylogit)))
results = rbind(results, data.frame(age_group = "all", hormone, virus_gene, gender = "all", tissue=t, OR = round(odds["hormone", 1], 2), CI_25 =  round(odds["hormone", 2], 2) ,
CI_75 =  round(odds["hormone", 3],2) , p =  summary(mylogit)$coefficients["hormone", 4]))
}
expr_meta_subset =  expr_meta[expr_meta$gender %in% c("male") & expr_meta$tissue %in% t,]
if (length(unique(expr_meta_subset$virus))!=1 & length(unique(expr_meta_subset$hormone))!=1){
mylogit = (glm(virus ~ hormone + source + age ,expr_meta_subset, family = binomial()))
odds = exp(cbind(OR = coef(mylogit), confint(mylogit)))
results = rbind(results, data.frame(age_group = "all", hormone, virus_gene,gender = "male",  tissue=t, OR = round(odds["hormone", 1], 2), CI_25 =  round(odds["hormone", 2], 2) ,
CI_75 =  round(odds["hormone", 3],2) , p =  summary(mylogit)$coefficients["hormone", 4]))
}
expr_meta_subset =  expr_meta[expr_meta$gender %in% c("female") & expr_meta$tissue %in% t,]
if (length(unique(expr_meta_subset$virus))!=1 & length(unique(expr_meta_subset$hormone))!=1){
mylogit = (glm(virus ~ hormone +  source + age , expr_meta_subset, family = binomial()))
odds = exp(cbind(OR = coef(mylogit), confint(mylogit)))
results = rbind(results, data.frame(age_group = "all", hormone, virus_gene,gender = "female", tissue=t, OR = round(odds["hormone", 1], 2), CI_25 =  round(odds["hormone", 2], 2) ,
CI_75 =  round(odds["hormone", 3],2) , p =  summary(mylogit)$coefficients["hormone", 4]))
}
#old
expr_meta_subset =   expr_meta[expr_meta$age %in% c("60-100") & expr_meta$tissue %in% t ,]
if (nrow(expr_meta_subset) > 30 & !t %in% c( "prostate", "testis", "small intestine", "heart") & length(unique(expr_meta_subset$virus))!=1 & length(unique(expr_meta_subset$hormone))!=1){
mylogit = (glm(virus ~ hormone +  gender + source , expr_meta_subset, family = binomial()))
odds = exp(cbind(OR = coef(mylogit), confint(mylogit)))
results = rbind(results, data.frame(age_group = "old", hormone, virus_gene,gender = "all",  tissue=t, OR = round(odds["hormone", 1], 2), CI_25 =  round(odds["hormone", 2], 2) ,
CI_75 =  round(odds["hormone", 3],2) , p =  summary(mylogit)$coefficients["hormone", 4]))
}
expr_meta_subset =   expr_meta[expr_meta$age %in% c("60-100") & expr_meta$gender %in% c("male")  & expr_meta$tissue %in% t,]
if (nrow(expr_meta_subset) > 30 & !t %in% c("bone", "brain", "breast", "small intestine", "heart") & length(unique(expr_meta_subset$virus))!=1 & length(unique(expr_meta_subset$hormone))!=1){
mylogit = (glm(virus ~ hormone + source , expr_meta_subset, family = binomial()))
odds = exp(cbind(OR = coef(mylogit), confint(mylogit)))
results = rbind(results, data.frame(age_group = "old",hormone, virus_gene, gender = "male", tissue=t, OR = round(odds["hormone", 1], 2), CI_25 =  round(odds["hormone", 2], 2) ,
CI_75 =  round(odds["hormone", 3],2) , p =  summary(mylogit)$coefficients["hormone", 4]))
}
expr_meta_subset =   expr_meta[expr_meta$age %in% c("60-100") & expr_meta$gender %in% c("female")  & expr_meta$tissue %in% t,]
if (nrow(expr_meta_subset) > 30  & !t %in% c("bone", "brain", "heart", "prostate", "testis", "small intestine", "skin") & length(unique(expr_meta_subset$virus))!=1 & length(unique(expr_meta_subset$hormone))!=1){
mylogit = (glm(virus ~ hormone +  source  ,expr_meta_subset, family = binomial()))
odds = exp(cbind(OR = coef(mylogit), confint(mylogit)))
results = rbind(results, data.frame(age_group = "old", hormone, virus_gene,gender = "female", tissue=t, OR = round(odds["hormone", 1], 2), CI_25 =  round(odds["hormone", 2], 2) ,
CI_75 =  round(odds["hormone", 3],2) , p =  summary(mylogit)$coefficients["hormone", 4]))
}
}
}
}
write.csv(results, "table4.csv")
View(results)
